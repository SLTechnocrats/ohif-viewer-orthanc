"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[4353],{64353:(e,o,a)=>{a.r(o),a.d(o,{default:()=>I});var t=a(84793);const l={CT:"ctToolGroup",PT:"ptToolGroup",Fusion:"fusionToolGroup",MIP:"mipToolGroup",default:"default"};const n=function(e,o,a,t,n,i){!function(e,o,a,t,n,i){const r={active:[{toolName:e.WindowLevel,bindings:[{mouseButton:o.MouseBindings.Primary}]},{toolName:e.Pan,bindings:[{mouseButton:o.MouseBindings.Auxiliary}]},{toolName:e.Zoom,bindings:[{mouseButton:o.MouseBindings.Secondary}]},{toolName:e.StackScrollMouseWheel,bindings:[]}],passive:[{toolName:e.Length},{toolName:e.ArrowAnnotate,configuration:{getTextCallback:(e,o)=>{n?e(" "):t.runCommand("arrowTextCallback",{callback:e,eventDetails:o})},changeTextCallback:(e,o,a)=>{void 0===n&&t.runCommand("arrowTextCallback",{callback:a,data:e,eventDetails:o})}}},{toolName:e.Bidirectional},{toolName:e.DragProbe},{toolName:e.Probe},{toolName:e.EllipticalROI},{toolName:e.RectangleROI},{toolName:e.StackScroll},{toolName:e.Angle},{toolName:e.CobbAngle},{toolName:e.Magnify},{toolName:"CircularBrush",parentTool:"Brush",configuration:{activeStrategy:"FILL_INSIDE_CIRCLE"}},{toolName:"CircularEraser",parentTool:"Brush",configuration:{activeStrategy:"ERASE_INSIDE_CIRCLE"}},{toolName:"SphereBrush",parentTool:"Brush",configuration:{activeStrategy:"FILL_INSIDE_SPHERE"}},{toolName:"SphereEraser",parentTool:"Brush",configuration:{activeStrategy:"ERASE_INSIDE_SPHERE"}},{toolName:"ThresholdCircularBrush",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_CIRCLE"}},{toolName:"ThresholdSphereBrush",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_SPHERE"}},{toolName:"ThresholdCircularBrushDynamic",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_CIRCLE",strategySpecificConfiguration:{THRESHOLD:{isDynamic:!0,dynamicRadius:3}}}}],enabled:[{toolName:e.SegmentationDisplay}],disabled:[{toolName:e.Crosshairs,configuration:{disableOnPassive:!0,autoPan:{enabled:!1,panSize:10}}}]};a.createToolGroupAndAddTools(l.CT,r),a.createToolGroupAndAddTools(l.PT,{active:r.active,passive:[...r.passive,{toolName:"RectangleROIStartEndThreshold"}],enabled:r.enabled,disabled:r.disabled}),a.createToolGroupAndAddTools(l.Fusion,r),a.createToolGroupAndAddTools(l.default,r);const s={active:[{toolName:e.VolumeRotateMouseWheel,configuration:{rotateIncrementDegrees:5}},{toolName:e.MipJumpToClick,configuration:{toolGroupId:l.PT},bindings:[{mouseButton:o.MouseBindings.Primary}]}],enabled:[{toolName:e.SegmentationDisplay},{toolName:e.OrientationMarker,configuration:{orientationWidget:{viewportCorner:"BOTTOM_LEFT"}}}]};a.createToolGroupAndAddTools(l.MIP,s)}(e,o,a,t,n)},{createButton:i}=t.ToolbarService,r={commandName:"setToolActiveToolbar",commandOptions:{toolGroupIds:[l.CT,l.PT,l.Fusion]}},s=[{id:"MeasurementTools",uiType:"ohif.splitButton",props:{groupId:"MeasurementTools",evaluate:"evaluate.group.promoteToPrimaryIfCornerstoneToolNotActiveInTheList",primary:i({id:"Length",icon:"tool-length",label:"Length",tooltip:"Length Tool",commands:r,evaluate:"evaluate.cornerstoneTool"}),secondary:{icon:"chevron-down",tooltip:"More Measure Tools"},items:[i({id:"Length",icon:"tool-length",label:"Length",tooltip:"Length Tool",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"Bidirectional",icon:"tool-bidirectional",label:"Bidirectional",tooltip:"Bidirectional Tool",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"ArrowAnnotate",icon:"tool-annotate",label:"Annotation",tooltip:"Arrow Annotate",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"CircleROI",icon:"tool-circle",label:"Circle",tooltip:"Circle Tool",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"PlanarFreehandROI",icon:"icon-tool-freehand-roi",label:"Freehand ROI",tooltip:"Freehand ROI",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"SplineROI",icon:"icon-tool-spline-roi",label:"Spline ROI",tooltip:"Spline ROI",commands:r,evaluate:"evaluate.cornerstoneTool"}),i({id:"LivewireContour",icon:"icon-tool-livewire",label:"Livewire tool",tooltip:"Livewire tool",commands:r,evaluate:"evaluate.cornerstoneTool"})]}},{id:"EllipticalROI",uiType:"ohif.radioGroup",props:{icon:"tool-ellipse",label:"Ellipse",tooltip:"Ellipse ROI",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"Magnify",uiType:"ohif.radioGroup",props:{icon:"tool-magnify",label:"Zoom-in",tooltip:"Zoom-in",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"RectangleROI",uiType:"ohif.radioGroup",props:{icon:"tool-rectangle",label:"Rectangle",tooltip:"Rectangle ROI",commands:r,evaluate:"evaluate.cornerstoneTool"}},{},{id:"Zoom",uiType:"ohif.radioGroup",props:{icon:"tool-zoom",label:"Zoom",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"WindowLevel",uiType:"ohif.radioGroup",props:{icon:"tool-window-level",label:"Window Level",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"Pan",uiType:"ohif.radioGroup",props:{type:"tool",icon:"tool-move",label:"Pan",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"Cine",uiType:"ohif.radioGroup",props:{icon:"tool-cine",label:"Cine",tooltip:"Cine",commands:"toggleCine",evaluate:["evaluate.cine","evaluate.not3D"]}},{id:"Angle",uiType:"ohif.radioGroup",props:{icon:"tool-angle",label:"Angle",tooltip:"Angle",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"TrackballRotate",uiType:"ohif.radioGroup",props:{type:"tool",icon:"tool-3d-rotate",label:"3D Rotate",commands:r,evaluate:{name:"evaluate.cornerstoneTool",disabledText:"Select a 3D viewport to enable this tool"}}},{id:"Capture",uiType:"ohif.radioGroup",props:{icon:"tool-capture",label:"Capture",commands:"showDownloadViewportModal",evaluate:"evaluate.action"}},{id:"Layout",uiType:"ohif.layoutSelector",props:{rows:3,columns:4,evaluate:"evaluate.action"}},{id:"StackScroll",uiType:"ohif.radioGroup",props:{icon:"tool-stack-scroll",label:"Stack Scroll",tooltip:"Stack Scroll",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"Probe",uiType:"ohif.radioGroup",props:{icon:"tool-probe",label:"Probe",tooltip:"Probe",commands:r,evaluate:"evaluate.cornerstoneTool"}},{id:"Crosshairs",uiType:"ohif.radioGroup",props:{type:"tool",icon:"tool-crosshair",label:"Crosshairs",commands:{commandName:"setToolActiveToolbar",commandOptions:{toolGroupIds:["mpr"]}},evaluate:{name:"evaluate.cornerstoneTool",disabledText:"Select an MPR viewport to enable this tool"}}},{id:"RectangleROIStartEndThreshold",uiType:"ohif.radioGroup",props:{icon:"tool-create-threshold",label:"Rectangle ROI Threshold",commands:r,evaluate:["evaluate.cornerstone.segmentation",{name:"evaluate.cornerstoneTool",disabledText:"Select the PT Axial to enable this tool"}],options:"tmtv.RectangleROIThresholdOptions"}},{id:"BrushTools",uiType:"ohif.buttonGroup",props:{groupId:"BrushTools",items:[{id:"Brush",icon:"icon-tool-brush",label:"Brush",evaluate:{name:"evaluate.cornerstone.segmentation",toolNames:["CircularBrush","SphereBrush"],disabledText:"Create new segmentation to enable this tool."},options:[{name:"Radius (mm)",id:"brush-radius",type:"range",min:.5,max:99.5,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["CircularBrush","SphereBrush"]}}},{name:"Shape",type:"radio",id:"brush-mode",value:"CircularBrush",values:[{value:"CircularBrush",label:"Circle"},{value:"SphereBrush",label:"Sphere"}],commands:"setToolActiveToolbar"}]},{id:"Eraser",icon:"icon-tool-eraser",label:"Eraser",evaluate:{name:"evaluate.cornerstone.segmentation",toolNames:["CircularEraser","SphereEraser"]},options:[{name:"Radius (mm)",id:"eraser-radius",type:"range",min:.5,max:99.5,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["CircularEraser","SphereEraser"]}}},{name:"Shape",type:"radio",id:"eraser-mode",value:"CircularEraser",values:[{value:"CircularEraser",label:"Circle"},{value:"SphereEraser",label:"Sphere"}],commands:"setToolActiveToolbar"}]},{id:"Threshold",icon:"icon-tool-threshold",label:"Threshold Tool",evaluate:{name:"evaluate.cornerstone.segmentation",toolNames:["ThresholdCircularBrush","ThresholdSphereBrush"]},options:[{name:"Radius (mm)",id:"threshold-radius",type:"range",min:.5,max:99.5,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["ThresholdCircularBrush","ThresholdSphereBrush","ThresholdCircularBrushDynamic"]}}},{name:"Threshold",type:"radio",id:"dynamic-mode",value:"ThresholdRange",values:[{value:"ThresholdDynamic",label:"Dynamic"},{value:"ThresholdRange",label:"Range"}],commands:({value:e,commandsManager:o})=>{"ThresholdDynamic"===e?o.run("setToolActive",{toolName:"ThresholdCircularBrushDynamic"}):o.run("setToolActive",{toolName:"ThresholdCircularBrush"})}},{name:"Shape",type:"radio",id:"eraser-mode",value:"ThresholdCircularBrush",values:[{value:"ThresholdCircularBrush",label:"Circle"},{value:"ThresholdSphereBrush",label:"Sphere"}],condition:({options:e})=>"ThresholdRange"===e.find((e=>"dynamic-mode"===e.id)).value,commands:"setToolActiveToolbar"},{name:"ThresholdRange",type:"double-range",id:"threshold-range",min:0,max:50,step:.5,value:[2.5,50],condition:({options:e})=>"ThresholdRange"===e.find((e=>"dynamic-mode"===e.id)).value,commands:{commandName:"setThresholdRange",commandOptions:{toolNames:["ThresholdCircularBrush","ThresholdSphereBrush"]}}}]}]}}],u=JSON.parse('{"u2":"@ohif/mode-tmtv"}').u2;var d=a(73577);const{MetadataProvider:c}=t.classes,m="@ohif/extension-default.layoutTemplateModule.viewerLayout",p="@ohif/extension-default.sopClassHandlerModule.stack",h="@ohif/extension-default.panelModule.seriesList",T="@ohif/extension-cornerstone.viewportModule.cornerstone",v="@ohif/extension-cornerstone-dicom-seg.panelModule.panelSegmentation",g="@ohif/extension-tmtv.hangingProtocolModule.ptCT",S="@ohif/extension-tmtv.panelModule.petSUV",b="@ohif/extension-tmtv.panelModule.tmtvBox",y="@ohif/extension-tmtv.panelModule.tmtvExport",f={"@ohif/extension-default":"^3.0.0","@ohif/extension-cornerstone":"^3.0.0","@ohif/extension-cornerstone-dicom-seg":"^3.0.0","@ohif/extension-tmtv":"^3.0.0",Report:"^0.0.1"},C=[];const I={id:u,modeFactory:function({modeConfiguration:e}){return{id:u,routeName:"tmtv",displayName:d.Z.t("Modes:Total Metabolic Tumor Volume"),onModeEnter:({servicesManager:e,extensionManager:o,commandsManager:a})=>{const{toolbarService:t,toolGroupService:i,customizationService:r,hangingProtocolService:u,displaySetService:d}=e.services,m=o.getModuleEntry("@ohif/extension-cornerstone.utilityModule.tools"),{toolNames:p,Enums:h}=m.exports;n(p,h,i,a,null,e);const{unsubscribe:T}=i.subscribe(i.EVENTS.VIEWPORT_ADDED,(()=>{const{displaySetMatchDetails:e}=u.getMatchDetails();!function(e,o,a,t){const n=e.get("ctDisplaySet");if(!n)return;const{SeriesInstanceUID:i}=n,r=t.getDisplaySetsForSeries(i),s={...a.getToolConfiguration(l.Fusion,o.Crosshairs),filterActorUIDsToSetSlabThickness:[r[0].displaySetInstanceUID]};a.setToolConfiguration(l.Fusion,o.Crosshairs,s)}(e,p,i,d),function(e,o,a,t){const n=e.get("ptDisplaySet");if(!n)return;const{SeriesInstanceUID:i}=n,r=t.getDisplaySetsForSeries(i);if(!r||0===r.length)return;const s=a.getToolConfiguration(l.Fusion,o.WindowLevel),u=a.getToolConfiguration(l.Fusion,o.EllipticalROI),d=`cornerstoneStreamingImageVolume:${r[0].displaySetInstanceUID}`,c={...s,volumeId:d},m={...u,volumeId:d};a.setToolConfiguration(l.Fusion,o.WindowLevel,c),a.setToolConfiguration(l.Fusion,o.EllipticalROI,m)}(e,p,i,d)}));C.push(T),t.addButtons(s),t.createButtonSection("primary",["MeasurementTools","EllipticalROI","RectangleROI","Zoom","Magnify","Pan","TrackballRotate","WindowLevel","StackScroll","Probe","Capture","Layout","Crosshairs","Cine","Angle","MoreTools"]),t.createButtonSection("ROIThresholdToolbox",["RectangleROIStartEndThreshold","BrushTools"]),r.addModeCustomizations([{id:"segmentation.panel",segmentationPanelMode:"expanded",addSegment:!1,onSegmentationAdd:()=>{a.run("createNewLabelmapFromPT")}}]),u.addCustomAttribute("getPTVOIRange","get PT VOI based on corrected or not",(e=>{const o=e.find((e=>"PT"===e.Modality));if(!o)return;const{imageId:a}=o.images[0],t=c.get("scalingModule",a);return t&&t.suvbw?{windowWidth:5,windowCenter:2.5}:void 0}))},onModeExit:({servicesManager:e})=>{const{toolGroupService:o,syncGroupService:a,segmentationService:t,cornerstoneViewportService:l,uiDialogService:n,uiModalService:i}=e.services;C.forEach((e=>e())),n.dismissAll(),i.hide(),o.destroy(),a.destroy(),t.destroy(),l.destroy()},validationTags:{study:[],series:[]},isValidMode:({modalities:e,study:o})=>{const a=e.split("\\");return{valid:a.includes("CT")&&"M1"!==o.mrn&&a.includes("PT")&&!["SM"].some((e=>a.includes(e)))&&"1.3.6.1.4.1.12842.1.1.14.3.20220915.105557.468.2963630849"!==o.studyInstanceUid,description:"The mode requires both PT and CT series in the study"}},routes:[{path:"tmtv",layoutTemplate:()=>({id:m,props:{leftPanels:[h],leftPanelClosed:!0,rightPanels:[[b,v,y],"Report.panelModule.Report",S],viewports:[{namespace:T,displaySetsToDisplay:[p]}]}})}],extensions:f,hangingProtocol:g,sopClassHandlers:[p],hotkeys:[...t.dD.defaults.hotkeyBindings],...e}},extensionDependencies:f}}}]);
//# sourceMappingURL=4353.bundle.7d1d19c4fe7a9dcbf7f9.js.map