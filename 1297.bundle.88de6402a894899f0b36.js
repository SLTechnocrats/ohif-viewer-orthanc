(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1297],{39720:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var n=a(43001),l=a(5706),i=a(94486),s=a.n(i),r=a(65193);const o=()=>{const e=r.Z.getItem("token");return String(e)};a(44379);function c(e){return e||""}function d(e){return null!=e&&e?.length>0}function m(e){return null!=e&&e?.length>0}function p(e){return null!=e&&e>0}function u(e){try{return new URL(e),!0}catch(e){return!1}}function g(e){try{return function(e){return/%[0-9A-Fa-f]{2}/.test(e)}(e)?decodeURIComponent(e):e}catch(t){return e}}const y="https://api.smaro.app/api",f="https://myradonapp.s3.amazonaws.com",_={get:async(e,t)=>{const a=o();console.log(a),e=c(e);const n={headers:{Token:a},params:t};return s().get(e,n)},post:async(e,t,a={})=>{const n=o(),l={method:"post",url:c(e),headers:{...a,Token:n},data:t};return s()(l)},put:async(e,t,a={})=>{const n=o(),l={method:"put",url:c(e),headers:{...a,Token:n},data:t};return s()(l)},delete:async(e,t,a={})=>{const n=o(),l={method:"delete",url:c(e),headers:{...a,Token:n},data:t};return s()(l)},endpoints:{report:{get:y+"/diagnostics/patient/report"},report_analysis:{get:{id:y+"/patient/report/analysis",radiologist:y+"/radiologist/report/analysis",patient:y+"/radiologist/report/analysis/patient"},update:y+"/patient/report/analysis/update",reportPDF:y+"/patient/report/analysis/pdf"},upload:{image:y+"/upload/picture",document:y+"/upload/picture"},modality:{get:y+"/modality"},test_type:{get:y+"/test-type",get_by_modality:y+"/test-type/by/modality-id"},dicom:{upload:y+"/upload/dicom/file "},template:{get_radiologist_templates:y+"/report-templates/template/by/radiologist-id"},report_images:{create:y+"/patient/report/analysis/image/create",get:y+"/patient/report/analysis/image",update:y+"/patient/report/analysis/image/update"},authCheck:y+"/check-auth-status"}},b={images:[],template:{comments:"",findings:"",impressions:"",label:"",modality_id:"",value:0},PatientId:"",address:"",age:0,assigned_by:0,branch_id:0,branch_name:"",client_id:0,client_login_id:0,client_name:"",clinical_history:"",findings:"",comments:"",techniques:"",clinical_history_count:0,clinical_history_file:"",dob:"",doctor_id:0,doctor_name:"",estatus:0,gender:"",hospital_id:0,id:0,referral_doctor:"",report_title:"",radiologist_name:"",impression:"",inserted_time:"",modality:"",modality_id:0,patient_email:"",patient_id:0,patient_mobile:"",patient_name:"",patient_report_id:0,patient_study_id:"",patient_study_instance_id:"",priority_type:"",radiologist_id:0,ref_code:"",registration_date:void 0,report_analysis_id:0,report_status:"",results_type:"",short_code:"",test_type:"",test_type_id:0,updated_time:void 0};var h=a(71086);function v(e){h.ZP.success(e,{position:"top-right"})}function E(e){h.ZP.error(e,{position:"top-right"})}var x=a(33901),w=a.n(x);const N=({label:e,children:t,bold:a,style:l})=>n.createElement("div",{className:"mr-[10px] flex items-center"},n.createElement("div",{className:"w-[35%]"},n.createElement("h3",{style:l,className:w()("min-w-max text-sm font-normal capitalize text-black",a&&"font-bold")},e)),n.createElement("div",{className:"text-wrap w-[65%] p-1 text-sm capitalize"},t)),C=({onChange:e,value:t,placeholder:a="Choose file",type:l="text"})=>n.createElement("input",{type:l,className:"w-full rounded-[6px] border border-[#DEE2E6] bg-white px-2 py-[5px] text-base font-normal text-black outline-none",value:t,onChange:e,placeholder:a});var k=a(89676);const M=({label:e,value:t,setValue:a,errorText:l,touched:i,bold:s})=>{const r=(0,n.useRef)(null);return n.createElement("div",{className:"flex flex-col"},n.createElement("h4",{className:w()("mb-[6px] text-sm capitalize text-black",s&&"!text-base !font-normal")},e),n.createElement("div",{className:"rounded border border-dashed border-gray-400 p-4"},n.createElement("input",{ref:r,type:"file",accept:".png ,.jpg ,.jpeg",name:"file",className:"hidden",onChange:async e=>{const t=e?.target?.files[0];if(!t)return void E("Invalid file");const n=t.size/1048576;if(n<=0)return void E("Please upload valid file");if(n>3)return void E("File size is more than 3MB,please upload file size less than 3 mb");const l=t.type,i=new FormData;i.append("file",t);try{let e;e="application/pdf"===l?`${_.endpoints.upload.document}/1`:`${_.endpoints.upload.image}/1`;const t={"Content-Type":"multipart/form-data"},{status:n,data:s}=await _.post(e,i,t);if(200===n){const{statusCode:e,data:t}=s;200===e&&a(t)}else E("Failed to upload file")}catch(e){E("An error occurred during the file upload")}}}),n.createElement("label",{onClick:()=>r?.current?.click(),className:"cursor-pointer text-blue-500 hover:underline"},"Choose file")),n.createElement("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300"},"PNG or JPG (MAX.3MB)."),d(t)&&n.createElement("a",{href:(o=t,u(o)?o:`${f}/${o}`),className:"h-[25px] w-[75px] cursor-pointer content-center rounded-lg bg-green-700 text-center text-xs font-medium text-white",target:"_blank",rel:"noreferrer"},"View File"),i&&l&&String(l)?.length>0&&n.createElement("span",{className:"text-xs text-red-600"},String(l)));var o},S=({initialImages:e=[],onChange:t})=>{const[a,l]=(0,n.useState)([]),i=e=>{const a=e.map((e=>e.file));t(a)};return(0,n.useEffect)((()=>{if(!m(a)&&m(e)){const t=e.map(((e,t)=>({id:Date.now()+t,file:e})));l(t)}}),[e]),n.createElement("div",{className:"flex flex-wrap gap-10",style:{gap:"20px"}},a.map(((e,t)=>n.createElement("div",{key:e.id,className:"relative",style:{position:"relative"}},n.createElement(M,{label:`Upload ${t+1}`,value:e.file,setValue:t=>((e,t)=>{const n=a.map((a=>a.id===e?{...a,file:t}:a));l(n),i(n)})(e.id,t)}),n.createElement(k.hME,{style:{position:"absolute",right:"-8px",top:"-15px"},className:"absolute -top-2 -right-2 mt-2 mr-2 cursor-pointer text-red-500",size:24,onClick:()=>(e=>{const t=a.filter((t=>t.id!==e));l(t),i(t)})(e.id)})))),n.createElement("button",{className:"mt-4 h-fit rounded bg-blue-500 p-2 text-white",onClick:()=>{l([...a,{id:Date.now(),file:""}])},style:{backgroundColor:"#0ea5e9",height:"fit-content"}},"Upload"))};var I=a(66715);const j=({label:e,value:t,setValue:a,options:l})=>{const[i,s]=(0,n.useState)({value:"",label:e,color:"black"});return(0,n.useEffect)((()=>{const a=l.find((e=>e.value===t));s(null!=a?a:{color:"",label:e,value:""})}),[l,t]),n.createElement(I.ZP,{value:i,styles:{option:e=>({...e,color:"black"}),container:e=>({...e,width:"100%",backgroundColor:"white"}),singleValue:e=>({...e,paddingLeft:"10px",paddingRight:"10px"})},onChange:e=>a(e),options:l,className:"bg-white text-base font-normal text-black",placeholder:e})};var R=a(50321),T=a(38902),F=a(54535),P=a.n(F),U=(a(41436),a(38714)),V=a(3657);const z={height:"200px",buttonList:[["undo","redo"],["removeFormat"],["bold","underline","italic"],["fontColor","hiliteColor"],["align","horizontalRule","list"],["table","link"],["fullScreen"]],katex:U.Z,fontSize:[8,9,10,11,12,14,16,18,20],font:["Arial","Comic Sans MS","Courier New","Impact","Georgia","tahoma","Trebuchet MS","Verdana"],colorList:["#828282","#FF5400","#676464","#F1F2F4","#FF9B00","#F00","#fa6e30","#000","rgba(255, 153, 0, 0.1)","#FF6600","#0099FF","#74CC6D","#FF9900","#CCCCCC"]},D=({onChange:e,value:t,placeholder:a})=>{const l=(0,n.useRef)();return n.createElement(P(),{setContents:g(t),height:"200px",placeholder:a,setOptions:z,onChange:t=>{t=g(t),t=V.Z.sanitize(t),e(encodeURIComponent(t))},getSunEditorInstance:e=>{l.current=e}})},$=({...e})=>{const[t,a]=(0,n.useState)(!0);return n.createElement("div",null,n.createElement("div",{className:"flex items-center justify-between text-black"},n.createElement("strong",null,e.sectionName),n.createElement("div",null,e.isEditEnabled&&!t&&n.createElement(R.zmo,{className:"fill-green-600",size:20,onClick:()=>a(!0)}),e.isEditEnabled&&t&&n.createElement(T.dSq,{className:"fill-blue-600",size:20,onClick:()=>a(!1)}))),t&&e.isEditEnabled?n.createElement("div",null,n.createElement("br",null),n.createElement(D,{value:e.value,onChange:t=>{e.onChangeValue(e.dataName,t)}})):n.createElement("div",{className:"text-black",dangerouslySetInnerHTML:{__html:g(e.value)}}),n.createElement("br",null))};var A=a(43573);function L(){const e=(0,A.TH)(),[t,a]=(0,n.useState)(null),[l,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const t=new URLSearchParams(e.search),n=t.get("bearer");if(d(n)){const e=decodeURIComponent(n);(e=>{r.Z.setItem("token",e)})(e),a(e)}const l=t.get("reportId");d(l)&&i(Number(l))}),[e.search]),{token:t,reportId:l}}const q=({label:e,value:t})=>n.createElement("div",{className:"w-full min-w-max"},n.createElement(N,{label:e},n.createElement("p",{className:"min-w-max font-bold text-black"},t))),O=[{label:"Select Result Status",value:"",color:"black"},{label:"Normal",value:"Normal",color:"black"},{label:"Abnormal",value:"Abnormal",color:"black"}],Z=()=>{const{token:e,reportId:t}=L(),{values:a,setFieldValue:i,handleSubmit:s}=(0,l.TA)({initialValues:b,onSubmit:async e=>{await I(e)}}),r=[{sectionName:"Clinical Information",dataName:"clinical_history",isEditable:!1},{sectionName:"Technique",dataName:"techniques",isEditable:!1},{sectionName:"Findings",dataName:"findings",isEditable:!0},{sectionName:"Impressions",dataName:"impression",isEditable:!0},{sectionName:"Comments",dataName:"comments",isEditable:!0}],[o,c]=(0,n.useState)([]),[g,y]=(0,n.useState)([]),[x,w]=(0,n.useState)([]),k=async e=>{if(y([]),!p(e))return;const{status:t,data:a}=await _.get(_.endpoints.test_type.get_by_modality+"/"+e,{});if(200===t){const{statusCode:e,data:t}=a;if(200===e){const e=t.map((e=>({value:e.id,label:e.test_type,color:"black"})));y([{label:"Select Test Type",value:""},...e])}}else y([])},M=async(e,t)=>{try{if(!p(t))return;if(!p(e))return void E("Invalid User Id");const a={"Content-Type":"application/json"},n=JSON.stringify({radiologist_id:e,modality_id:t}),{status:l,data:i}=await _.post(`${_.endpoints.template.get_radiologist_templates}`,n,a);if(200===l){const{statusCode:e,data:t}=i;if(200===e){const e=t.map((e=>({label:e.report_template_name,value:e.id,findings:e.findings,impression:e.impression,comments:e.comments,modality_id:e.modality_id})));w(e)}else E("Report templates not found,please add some templates")}}catch(e){E("Report templates not found,please add some templates")}},I=async e=>{try{if(!e.id)return void E("Invalid Report Id");if(!e.report_analysis_id)return void E("Invalid Report Analysis ID");const t={"Content-Type":"application/json"},{status:n,data:l}=await _.post(_.endpoints.report_analysis.update,JSON.stringify({...e,techniques:encodeURIComponent(e.techniques),clinical_history:encodeURIComponent(e.clinical_history)}),t);if(200===n){const{statusCode:e}=l;200===e&&(m(a.images)&&(await F(),await R(a.id)),v("Success! Patient Report Saved"))}else E("Failure! Patient Report Not Saved")}catch(e){E("Something went wrong,please try again")}},R=async e=>{if(p(e))try{const{status:t,data:a}=await _.get(`${_.endpoints.report.get}/${e}`);if(200===t){const{statusCode:e,data:t}=a;if(200===e)if(m(t)){const e=t[0];i("id",e?.id),i("radiologist_id",e?.radiologist_id),i("branch_name",e?.branch_name),i("radiologist_name",e?.radiologist_name),i("report_analysis_id",e?.report_analysis_id),i("PatientId",d(e?.PatientId)?e?.PatientId:e?.patient_id??""),i("patient_id",e?.patient_id),i("patient_name",e?.patient_name),i("age",e?.age),i("gender",e?.gender),i("referral_doctor",d(e?.referral_doctor)?e?.referral_doctor:e?.doctor_name??""),i("priority_type",e?.priority_type),i("results_type",e?.results_type),i("report_status",e?.report_status),i("modality_id",e?.modality_id),i("test_type_id",e?.test_type_id),i("clinical_history",e?.clinical_history),i("clinical_history_file",e?.clinical_history_file),i("techniques",e?.techniques),i("findings",e?.findings),i("impression",e?.impression),i("comments",e?.comments),i("report_title",e?.report_title),await k(e?.modality_id),await M(e?.radiologist_id,e?.modality_id),await(async e=>{if(e)try{const{data:t}=await _.get(`${_.endpoints.report_images.get}/${e}`),{data:a,statusCode:n}=t;if(200===n){const e=a.map((e=>`${f}/${e.image}`));i("images",e)}}catch(e){E("Something went wrong")}})(e?.report_analysis_id)}else E("Unable to fetch patient report");else E("Unable to fetch patient report")}}catch(e){E("Unable to fetch patient report")}else E("Invalid Report Id")},T=async e=>{const t=e.map((e=>({report_analysis_id:a.report_analysis_id,image:e}))),n={report_analysis_id:a.report_analysis_id,reportImages:t},l={"Content-Type":"application/json"};try{const{data:e}=await _.put(_.endpoints.report_images.update,n,l),{statusCode:t}=e;200===t?v("Image updated successfully"):E("Image update failed")}catch(e){E("Upload failed please try again")}},F=async()=>{if(!a.images.length)return void await T([]);if(a.images.find((e=>e.includes(f)))){const e=a.images.map((e=>e.replace(`${f}/`,"")));await T(e)}else await(async()=>{const e={reportImages:a.images.map((e=>({report_analysis_id:a.report_analysis_id,image:e})))};try{const{data:t}=await _.post(_.endpoints.report_images.create,e),{statusCode:a,data:n}=t;200===a?(v("Image uploaded successfully"),i("images",n)):E("Something went wrong")}catch(e){E("Something went wrong,please try again")}})()},P=d(a?.referral_doctor)?a?.referral_doctor:a?.doctor_name??"";return(0,n.useEffect)((()=>{d(e)&&p(t)&&(async()=>{await(async()=>{try{const{status:e,data:t}=await _.get(_.endpoints.modality.get,{});if(200===e){const{statusCode:e,data:a}=t;if(200===e){const e=a.map((e=>({value:e.id,label:e.modality})));c(e)}}}catch(e){E("Not able to get modalities")}})(),await R(t)})()}),[e,t]),p(a?.id)?n.createElement("div",{style:{position:"relative"},className:"min-h-[calc(100vh-100px)] w-full overflow-y-auto rounded border border-gray-400 bg-white p-1"},n.createElement(h.x7,null),n.createElement("div",{className:"w-full border-gray-400 bg-purple-200 p-1"},n.createElement("div",{className:"mb-4 grid w-full grid-cols-2 gap-y-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2"},n.createElement(q,{label:"Patient Id",value:a?.patient_id}),n.createElement(q,{label:"Name",value:a?.patient_name}),n.createElement(q,{label:"Gender",value:a?.gender}),n.createElement(q,{label:"Age",value:a?.age}),n.createElement(q,{label:"Diagnostics",value:a?.branch_name}),n.createElement(q,{label:"Doctor",value:P}),n.createElement(q,{label:"Radiologist",value:a?.radiologist_name}),n.createElement(q,{label:"Priority",value:a?.priority_type}),n.createElement(q,{label:"Report Status",value:(V=a?.report_status,"Inprocess"===V?"In Progress":V)})),n.createElement("div",{className:"grid w-full gap-y-3"},n.createElement(N,{label:"Report Title"},n.createElement(C,{value:a.report_title,onChange:e=>i("report_title",e.target.value),placeholder:"Enter Report Title"})),n.createElement(N,{label:"Result"},n.createElement(j,{label:"Select Result",options:O,setValue:e=>i("results_type",e.value),value:a.results_type})),n.createElement(N,{label:"Modality"},n.createElement(j,{label:"Select Modality",value:a.modality_id,setValue:e=>(async e=>{i("modality_id",e.value),await k(e.value),await M(a.radiologist_id,e.value)})(e),options:o})),n.createElement(N,{label:"Test Type"},n.createElement(j,{label:"Select Test Type",options:g,setValue:e=>i("test_type_id",e.value),value:a.test_type_id})),n.createElement(N,{label:"Template"},n.createElement(j,{label:"Select Template",options:x,setValue:e=>(e=>{i("template",e),i("report_title",e.label);for(const t of r)t.isEditable&&i(t.dataName,e[t.dataName])})(e),value:a.template.value})))),n.createElement("div",null,d(a?.clinical_history_file)&&n.createElement("div",{className:"my-1"},n.createElement("h4",{className:"mb-2 text-sm font-bold text-black"},"Prescription"),n.createElement("a",{href:(U=String(a.clinical_history_file),u(U)?U:`${f}/${U}`),target:"_blank",className:"h-[35px] w-[150px] content-center items-center rounded bg-blue-700 p-1 text-center text-sm text-white dark:text-white",rel:"noreferrer"},"View File"))),n.createElement("div",{className:"my-3 w-full"},a&&r.map((e=>n.createElement($,{key:e.dataName,isEditEnabled:e.isEditable,sectionName:e.sectionName,dataName:e.dataName,onChangeValue:i,value:a[e.dataName]})))),n.createElement("div",{className:"my-3 w-full pt-5"},n.createElement("h1",{className:"mb-5 font-bold text-black"},"Upload Images"),n.createElement(S,{initialImages:a.images,onChange:e=>i("images",e)})),n.createElement("div",{style:{position:"fixed",bottom:"10px",right:"10px"},className:"absolute flex items-center justify-end gap-x-2 border-[#CED4DA] px-4"},n.createElement("button",{className:"rounded-[4px] bg-[#6C757D] p-2 text-base font-semibold text-white"},"Cancel"),n.createElement("button",{className:"rounded-[4px] bg-green-700 p-2 text-base font-semibold text-white",onClick:()=>s()},"Send Report Back"))):n.createElement("div",{className:"flex h-full w-full content-center items-center justify-center rounded border border-gray-400 bg-white p-1 text-center"},d(e)?n.createElement("span",{className:"text-bold animate-pulse text-xl text-red-700"},"Loading, please wait..."):n.createElement("span",{className:"text-bold text-xl text-red-700"},"You are not authorised to view this panel, Please exit."));var U,V},B={id:"Report",preRegistration:({servicesManager:e,commandsManager:t,configuration:a={}})=>{},getPanelModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>[{name:"Report",iconName:"logo-ohif-small",iconLabel:"Report",label:"Report",component:Z}],getViewportModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getToolbarModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getLayoutTemplateModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getSopClassHandlerModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getHangingProtocolModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getContextModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getDataSourcesModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{}}},86509:(e,t,a)=>{var n={"./ckb.js":42897,"./cs.js":28798,"./da.js":92304,"./de.js":55406,"./en.js":6731,"./es.js":90466,"./fa.js":35339,"./fr.js":88693,"./he.js":42788,"./index.js":75193,"./it.js":13703,"./ja.js":1735,"./ko.js":2042,"./lv.js":96497,"./nl.js":25778,"./pl.js":75869,"./pt_br.js":7581,"./ro.js":27834,"./ru.js":83074,"./se.js":63661,"./tr.js":62429,"./ua.js":79684,"./ur.js":38337,"./zh_cn.js":92534};function l(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}l.keys=function(){return Object.keys(n)},l.resolve=i,e.exports=l,l.id=86509},8056:()=>{}}]);
//# sourceMappingURL=1297.bundle.88de6402a894899f0b36.js.map