(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5113],{25251:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var l=a(43001),n=a(5706),i=a(94486),s=a.n(i),o=a(65193);const r=()=>{const e=o.Z.getItem("token");return String(e)};a(44379);function c(e){return e||""}function d(e){return null!=e&&e?.length>0}function m(e){return null!=e&&e?.length>0}function p(e){return null!=e&&e>0}const u="https://dev-api.smaro.app/api",g="https://myradonapp.s3.amazonaws.com",y={get:async(e,t)=>{const a=r();console.log(a),e=c(e);const l={headers:{Token:a},params:t};return s().get(e,l)},post:async(e,t,a={})=>{const l=r(),n={method:"post",url:c(e),headers:{...a,Token:l},data:t};return s()(n)},put:async(e,t,a={})=>{const l=r(),n={method:"put",url:c(e),headers:{...a,Token:l},data:t};return s()(n)},delete:async(e,t,a={})=>{const l=r(),n={method:"delete",url:c(e),headers:{...a,Token:l},data:t};return s()(n)},endpoints:{report:{get:u+"/diagnostics/patient/report"},report_analysis:{get:{id:u+"/patient/report/analysis",radiologist:u+"/radiologist/report/analysis",patient:u+"/radiologist/report/analysis/patient"},update:u+"/patient/report/analysis/update",reportPDF:u+"/patient/report/analysis/pdf"},upload:{image:u+"/upload/picture",document:u+"/upload/picture"},modality:{get:u+"/modality"},test_type:{get:u+"/test-type",get_by_modality:u+"/test-type/by/modality-id"},dicom:{upload:u+"/upload/dicom/file "},template:{get_radiologist_templates:u+"/report-templates/template/by/radiologist-id"},report_images:{create:u+"/patient/report/analysis/image/create",get:u+"/patient/report/analysis/image",update:u+"/patient/report/analysis/image/update"},authCheck:u+"/check-auth-status"}},_={images:[],template:{comments:"",findings:"",impressions:"",label:"",modality_id:"",value:0},PatientId:"",address:"",age:0,assigned_by:0,branch_id:0,branch_name:"",client_id:0,client_login_id:0,client_name:"",clinical_history:"",findings:"",comments:"",techniques:"",clinical_history_count:0,clinical_history_file:"",dob:"",doctor_id:0,doctor_name:"",estatus:0,gender:"",hospital_id:0,id:0,referral_doctor:"",report_title:"",radiologist_name:"",impression:"",inserted_time:"",modality:"",modality_id:0,patient_email:"",patient_id:0,patient_mobile:"",patient_name:"",patient_report_id:0,patient_study_id:"",patient_study_instance_id:"",priority_type:"",radiologist_id:0,ref_code:"",registration_date:void 0,report_analysis_id:0,report_status:"",results_type:"",short_code:"",test_type:"",test_type_id:0,updated_time:void 0};var b=a(71086);function f(e){b.ZP.error(e,{position:"top-right"})}var h=a(33901),v=a.n(h);const E=({label:e,children:t,bold:a,style:n})=>l.createElement("div",{className:"mr-[10px] flex items-center"},l.createElement("div",{className:"w-[35%]"},l.createElement("h3",{style:n,className:v()("min-w-max text-sm font-normal capitalize text-black",a&&"font-bold")},e)),l.createElement("div",{className:"text-wrap w-[65%] p-1 text-sm capitalize"},t)),x=({onChange:e,value:t,placeholder:a="Choose file",type:n="text"})=>l.createElement("input",{type:n,className:"w-full rounded-[6px] border border-[#DEE2E6] bg-white px-2 py-[5px] text-base font-normal text-black outline-none",value:t,onChange:e,placeholder:a});var w=a(89676);const N=({label:e,value:t,setValue:a,errorText:n,touched:i,bold:s})=>{const o=(0,l.useRef)(null);return l.createElement("div",{className:"flex flex-col"},l.createElement("h4",{className:v()("mb-[6px] text-sm capitalize text-black",s&&"!text-base !font-normal")},e),l.createElement("div",{className:"rounded border border-dashed border-gray-400 p-4"},l.createElement("input",{ref:o,type:"file",accept:".png ,.jpg ,.jpeg",name:"file",className:"hidden",onChange:async e=>{const t=e?.target?.files[0];if(!t)return void f("Invalid file");const l=t.size/1048576;if(l<=0)return void f("Please upload valid file");if(l>3)return void f("File size is more than 3MB,please upload file size less than 3 mb");const n=t.type,i=new FormData;i.append("file",t);try{let e;e="application/pdf"===n?`${y.endpoints.upload.document}/1`:`${y.endpoints.upload.image}/1`;const t={"Content-Type":"multipart/form-data"},{status:l,data:s}=await y.post(e,i,t);if(200===l){const{statusCode:e,data:t}=s;console.log(t,"data"),200===e&&a(t)}else f("Failed to upload file")}catch(e){f("An error occurred during the file upload")}}}),l.createElement("label",{onClick:()=>o?.current?.click(),className:"cursor-pointer text-blue-500 hover:underline"},"Choose file")),l.createElement("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300"},"PNG or JPG (MAX.3MB)."),t&&l.createElement("img",{src:(r=t,function(e){try{return new URL(e),!0}catch(e){return!1}}(r)?r:`${g}/${r}`),className:"max-w-sm",alt:"value"}),i&&n&&String(n)?.length>0&&l.createElement("span",{className:"text-xs text-red-600"},String(n)));var r},C=({initialImages:e=[],onChange:t})=>{const[a,n]=(0,l.useState)([]),i=e=>{const a=e.map((e=>e.file));t(a)};return(0,l.useEffect)((()=>{if(!a.length){const t=e.map(((e,t)=>({id:Date.now()+t,file:e})));n(t)}}),[e]),l.createElement("div",{className:"flex flex-wrap gap-10",style:{gap:"20px"}},a.map(((e,t)=>l.createElement("div",{key:e.id,className:"relative",style:{position:"relative"}},l.createElement(N,{label:`Upload ${t+1}`,value:e.file,setValue:t=>((e,t)=>{const l=a.map((a=>a.id===e?{...a,file:t}:a));n(l),i(l)})(e.id,t)}),l.createElement(w.hME,{style:{position:"absolute",right:"-8px",top:"-15px"},className:"absolute -top-2 -right-2 mt-2 mr-2 cursor-pointer text-red-500",size:24,onClick:()=>(e=>{const t=a.filter((t=>t.id!==e));n(t),i(t)})(e.id)})))),l.createElement("button",{className:"mt-4 h-fit rounded bg-blue-500 p-2 text-white",onClick:()=>{n([...a,{id:Date.now(),file:""}])},style:{backgroundColor:"#0ea5e9",height:"fit-content"}},"Upload"))};var M=a(66715);const k=({label:e,value:t,setValue:a,options:n})=>{const[i,s]=(0,l.useState)({value:"",label:e,color:"black"});return(0,l.useEffect)((()=>{const a=n.find((e=>e.value===t));s(null!=a?a:{color:"",label:e,value:""})}),[n,t]),l.createElement(M.ZP,{value:i,styles:{option:e=>({...e,color:"black"}),container:e=>({...e,width:"100%",backgroundColor:"white"}),singleValue:e=>({...e,paddingLeft:"10px",paddingRight:"10px"})},onChange:e=>a(e),options:n,className:"bg-white text-base font-normal text-black",placeholder:e})};var S=a(37517),I=a.n(S),R=(a(24003),a(50321)),T=a(38902),P=a(3657);const U=({value:e,setValue:t,dataKey:a,title:n,isEditEnabled:i})=>{const[s,o]=(0,l.useState)(!0),[r,c]=(0,l.useState)(decodeURIComponent(e));return(0,l.useEffect)((()=>{c(decodeURIComponent(e))}),[e]),l.createElement("div",{className:"mb-3"},l.createElement("div",{className:"flex items-center justify-between text-black"},l.createElement("h5",{className:"mb-2 text-sm font-bold"},n),l.createElement("div",null,i&&!s&&l.createElement(R.zmo,{className:"fill-green-600",size:20,onClick:()=>o(!0)}),i&&s&&l.createElement(T.dSq,{className:"fill-blue-600",size:20,onClick:()=>o(!1)}))),s&&i?l.createElement(I(),{onChange:e=>{e=P.Z.sanitize(e),c(e),t(a,encodeURIComponent(e))},className:"text-black",value:r}):l.createElement("div",{className:"text-black",dangerouslySetInnerHTML:{__html:r}}))};var $=a(43573);const V=({label:e,value:t})=>l.createElement("div",{className:"w-full min-w-max"},l.createElement(E,{label:e},l.createElement("p",{className:"min-w-max font-bold text-black"},t))),z=[{label:"Select Result Status",value:"",color:"black"},{label:"Normal",value:"Normal",color:"black"},{label:"Abnormal",value:"Abnormal",color:"black"}],D=()=>{const{token:e,reportId:t}=function(){const e=(0,$.TH)(),t=new URLSearchParams(e.search),a=t.get("bearer"),l=t.get("reportId");return{token:a??null,reportId:l?Number(l):0}}(),{values:a,setFieldValue:i,handleSubmit:s}=(0,n.TA)({initialValues:_,onSubmit:async e=>{await S(e)}}),o=[{sectionName:"Clinical Information",dataName:"clinical_history",isEditable:!1},{sectionName:"Technique",dataName:"techniques",isEditable:!1},{sectionName:"Findings",dataName:"findings",isEditable:!0},{sectionName:"Impressions",dataName:"impression",isEditable:!0},{sectionName:"Comments",dataName:"comments",isEditable:!0}],[r,c]=(0,l.useState)([]),[u,h]=(0,l.useState)([]),[v,w]=(0,l.useState)([]),N=async e=>{if(h([]),!p(e))return;const{status:t,data:a}=await y.get(y.endpoints.test_type.get_by_modality+"/"+e,{});if(200===t){const{statusCode:e,data:t}=a;if(200===e){const e=t.map((e=>({value:e.id,label:e.test_type,color:"black"})));h([{label:"Select Test Type",value:""},...e])}}else h([])},M=async(e,t)=>{try{if(!p(t))return;if(!p(e))return void f("Invalid User Id");const a={"Content-Type":"application/json"},l=JSON.stringify({radiologist_id:e,modality_id:t}),{status:n,data:i}=await y.post(`${y.endpoints.template.get_radiologist_templates}`,l,a);if(200===n){const{statusCode:e,data:t}=i;if(200===e){const e=t.map((e=>({label:e.report_template_name,value:e.id,findings:e.findings,impression:e.impression,comments:e.comments,modality_id:e.modality_id})));w(e)}else f("Report templates not found,please add some templates")}}catch(e){f("Report templates not found,please add some templates")}},S=async e=>{try{if(!e.id)return void f("Invalid Report Id");if(!e.report_analysis_id)return void f("Invalid Report Analysis ID");const l={"Content-Type":"application/json"},{status:n,data:i}=await y.post(y.endpoints.report_analysis.update,JSON.stringify({...e,techniques:encodeURIComponent(e.techniques),clinical_history:encodeURIComponent(e.clinical_history)}),l);if(200===n){const{statusCode:e}=i;200===e&&(m(a.images)&&(await T(),await I(a.id)),t="Success! Patient Report Saved",b.ZP.success(t,{position:"top-right"}))}else f("Failure! Patient Report Not Saved")}catch(e){f("Something went wrong,please try again")}var t},I=async e=>{if(p(e))try{const{status:t,data:a}=await y.get(`${y.endpoints.report.get}/${e}`);if(200===t){const{statusCode:e,data:t}=a;if(200===e)if(m(t)){const e=t[0];i("id",e?.id),i("radiologist_id",e?.radiologist_id),i("report_analysis_id",e?.report_analysis_id),i("PatientId",d(e?.PatientId)?e?.PatientId:e?.patient_id??""),i("patient_id",e?.patient_id),i("patient_name",e?.patient_name),i("age",e?.age),i("gender",e?.gender),i("referral_doctor",d(e?.referral_doctor)?e?.referral_doctor:e?.doctor_name??""),i("priority_type",e?.priority_type),i("results_type",e?.results_type),i("modality_id",e?.modality_id),i("test_type_id",e?.test_type_id),i("clinical_history",e?.clinical_history),i("clinical_history_file",e?.clinical_history_file),i("techniques",e?.techniques),i("findings",e?.findings),i("impression",e?.impression),i("comments",e?.comments),i("report_title",e?.report_title),await N(e?.modality_id),await M(e?.radiologist_id,e?.modality_id),await(async e=>{if(e)try{const{data:t}=await y.get(`${y.endpoints.report_images.get}/${e}`),{data:a,statusCode:l}=t;if(200===l){const e=a.map((e=>`${g}/${e.image}`));i("images",e)}}catch(e){f("Something went wrong")}})(e?.report_analysis_id)}else f("Unable to fetch patient report");else f("Unable to fetch patient report")}}catch(e){f("Unable to fetch patient report")}else f("Invalid Report Id")},R=async e=>{const t=e.map((e=>({report_analysis_id:a.report_analysis_id,image:e}))),l={report_analysis_id:a.report_analysis_id,reportImages:t};try{const{data:e}=await y.put(y.endpoints.report_images.update,l),{statusCode:t}=e;200!==t&&f("Something went wrong")}catch(e){f("Update failed")}},T=async()=>{if(!a.images.length)return void await R([]);if(a.images.find((e=>e.includes(g)))){const e=a.images.map((e=>e.replace(`${g}/`,"")));await R(e)}else await(async()=>{const e={reportImages:a.images.map((e=>({report_analysis_id:a.report_analysis_id,image:e})))};try{const{data:t}=await y.post(y.endpoints.report_images.create,e),{statusCode:a}=t;200!==a&&f("Something went wrong")}catch(e){f("Something went wrong,please try again")}})()},P=d(a?.referral_doctor)?a?.referral_doctor:a?.doctor_name??"";return(0,l.useEffect)((()=>{d(e)&&p(t)&&(async()=>{await(async()=>{try{const{status:e,data:t}=await y.get(y.endpoints.modality.get,{});if(200===e){const{statusCode:e,data:a}=t;if(200===e){const e=a.map((e=>({value:e.id,label:e.modality})));c(e)}}}catch(e){f("Not able to get modalities")}})(),await I(t)})()}),[e,t]),d(e)?l.createElement("div",{style:{position:"relative"},className:"min-h-[calc(100vh-100px)] w-full overflow-y-auto rounded border border-gray-400 bg-white p-1"},l.createElement(b.x7,null),l.createElement("div",{className:"w-full border-gray-400 bg-purple-200 p-1"},l.createElement("div",{className:"mb-4 grid w-full grid-cols-2 gap-y-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2"},l.createElement(V,{label:"Patient Id",value:a?.patient_id}),l.createElement(V,{label:"Name",value:a?.patient_name}),l.createElement(V,{label:"Gender",value:a?.gender}),l.createElement(V,{label:"Age",value:a?.age}),l.createElement(V,{label:"Diagnostics",value:a?.branch_name}),l.createElement(V,{label:"Doctor",value:P}),l.createElement(V,{label:"Radiologist",value:a?.radiologist_name}),l.createElement(V,{label:"Priority",value:a?.priority_type}),l.createElement(V,{label:"Report Status",value:(q=a?.report_status,"Inprocess"===q?"In Progress":q)})),l.createElement("div",{className:"grid w-full gap-y-3"},l.createElement(E,{label:"Report Title"},l.createElement(x,{value:a.report_title,onChange:e=>i("report_title",e.target.value),placeholder:"Enter Report Title"})),l.createElement(E,{label:"Result"},l.createElement(k,{label:"Select Result",options:z,setValue:e=>i("results_type",e.value),value:a.results_type})),l.createElement(E,{label:"Modality"},l.createElement(k,{label:"Select Modality",value:a.modality_id,setValue:e=>(async e=>{i("modality_id",e.value),await N(e.value),await M(a.radiologist_id,e.value)})(e),options:r})),l.createElement(E,{label:"Test Type"},l.createElement(k,{label:"Select Test Type",options:u,setValue:e=>i("test_type_id",e.value),value:a.test_type_id})),l.createElement(E,{label:"Template"},l.createElement(k,{label:"Select Template",options:v,setValue:e=>(e=>{i("template",e),i("report_title",e.label);for(const t of o)t.isEditable&&i(t.dataName,e[t.dataName])})(e),value:a.template.value})))),l.createElement("div",null,d(a?.clinical_history_file)&&l.createElement("div",{className:"my-1"},l.createElement("h4",{className:"mb-2 text-sm font-bold text-black"},"Prescription"),l.createElement("a",{href:(D=String(a.clinical_history_file),function(e){try{return new URL(e),!0}catch(e){return!1}}(D)?D:`${g}/${D}`),target:"_blank",className:"h-[35px] w-[150px] content-center items-center rounded bg-blue-700 p-1 text-center text-sm text-white dark:text-white",rel:"noreferrer"},"View File"))),l.createElement("div",{className:"my-3 w-full"},a&&o.map((e=>l.createElement(U,{key:e.dataName,isEditEnabled:e.isEditable,title:e.sectionName,dataKey:e.dataName,setValue:i,value:a[e.dataName]})))),l.createElement("div",{className:"my-3 w-full pt-5"},l.createElement("h1",{className:"mb-5 font-bold text-black"},"Upload Images"),l.createElement(C,{initialImages:a.images,onChange:e=>i("images",e)})),l.createElement("div",{style:{position:"fixed",bottom:"10px",right:"10px"},className:"absolute flex w-full items-center justify-end gap-x-2 border-[#CED4DA] px-4"},l.createElement("button",{className:"rounded-[4px] bg-[#6C757D] p-2 text-base font-semibold text-white"},"Cancel"),l.createElement("button",{className:"rounded-[4px] bg-green-700 p-2 text-base font-semibold text-white",onClick:()=>s()},"Send Report Back"))):l.createElement("div",{className:"flex h-full w-full content-center items-center justify-center rounded border border-gray-400 bg-white p-1 text-center"},l.createElement("span",{className:"text-bold text-xl text-red-700"},"You are not authorised to view this panel, Please exit."));var D,q},q={id:"Report",preRegistration:({servicesManager:e,commandsManager:t,configuration:a={}})=>{},getPanelModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>[{name:"Report",iconName:"logo-ohif-small",iconLabel:"Report",label:"Report",component:D}],getViewportModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getToolbarModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getLayoutTemplateModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getSopClassHandlerModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getHangingProtocolModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getContextModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getDataSourcesModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{}}},8056:()=>{}}]);
//# sourceMappingURL=5113.bundle.055ad6aec27505848d24.js.map