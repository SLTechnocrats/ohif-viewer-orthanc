(self.webpackChunk=self.webpackChunk||[]).push([[831],{61942:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var n=a(86326),l=a(95077),r=a(26899),i=a.n(r),o=a(66301);const s=()=>{const e=o.A.getItem("token");return String(e)};a(637);function d(e){return e||""}function c(e){return null!=e&&e?.length>0}function p(e){return null!=e&&e?.length>0}function m(e){return null!=e&&e>0}function u(e){try{return new URL(e),!0}catch(e){return!1}}function g(e){try{return function(e){return/%[0-9A-Fa-f]{2}/.test(e)}(e)?decodeURIComponent(e):e}catch(t){return e}}const _="https://api.smaro.app/api",y="https://myradonapp.s3.amazonaws.com",f={get:async(e,t)=>{const a=s();e=d(e);const n={headers:{Token:a},params:t};return i().get(e,n)},post:async(e,t,a={})=>{const n=s(),l={method:"post",url:d(e),headers:{...a,Token:n},data:t};return i()(l)},put:async(e,t,a={})=>{const n=s(),l={method:"put",url:d(e),headers:{...a,Token:n},data:t};return i()(l)},delete:async(e,t,a={})=>{const n=s(),l={method:"delete",url:d(e),headers:{...a,Token:n},data:t};return i()(l)},endpoints:{report:{get:_+"/diagnostics/patient/report"},report_analysis:{get:{id:_+"/patient/report/analysis",radiologist:_+"/radiologist/report/analysis",patient:_+"/radiologist/report/analysis/patient"},update:_+"/patient/report/analysis/update",reportPDF:_+"/patient/report/analysis/pdf"},upload:{image:_+"/upload/picture",document:_+"/upload/picture"},modality:{get:_+"/modality"},test_type:{get:_+"/test-type",get_by_modality:_+"/test-type/by/modality-id"},dicom:{upload:_+"/upload/dicom/file "},template:{get_radiologist_templates:_+"/report-templates/radiologist/template/search"},report_images:{create:_+"/patient/report/analysis/image/create",get:_+"/patient/report/analysis/image",update:_+"/patient/report/analysis/image/update"},authCheck:_+"/check-auth-status"}},h={images:[],template:{id:0,template:"",label:"",test_type_id:0,modality_id:0,value:0},PatientID:"",address:"",age:0,assigned_by:0,branch_id:0,branch_name:"",client_id:0,client_login_id:0,client_name:"",clinical_history:"",report_template:"",techniques:"",clinical_history_count:0,clinical_history_file:"",dob:"",doctor_id:0,doctor_name:"",estatus:0,gender:"",hospital_id:0,id:0,referral_doctor:"",report_title:"",radiologist_name:"",impression:"",inserted_time:"",modality:"",modality_id:0,patient_email:"",patient_id:0,patient_mobile:"",patient_name:"",patient_report_id:0,patient_study_id:"",patient_study_instance_id:"",priority_type:"",radiologist_id:0,ref_code:"",registration_date:void 0,report_analysis_id:0,report_status:"",results_type:"",short_code:"",test_type:"",test_type_id:0,updated_time:void 0};var b=a(16380);function v(e){b.Ay.success(e,{position:"top-right"})}function x(e){b.Ay.error(e,{position:"top-right"})}var E=a(55530),w=a.n(E);const N=({label:e,children:t,bold:a,style:l})=>n.createElement("div",{className:"mr-[10px] flex items-center"},n.createElement("div",{className:"w-[35%]"},n.createElement("h3",{style:l,className:w()("min-w-max text-sm font-normal capitalize text-black",a&&"font-bold")},e)),n.createElement("div",{className:"text-wrap w-[65%] p-1 text-sm capitalize"},t)),C=({onChange:e,value:t,placeholder:a="Choose file",type:l="text"})=>n.createElement("input",{type:l,className:"w-full rounded-[6px] border border-[#DEE2E6] bg-white px-2 py-[5px] text-base font-normal text-black outline-none",value:t,onChange:e,placeholder:a});var k=a(86460);const I=({label:e,value:t,setValue:a,errorText:l,touched:r,bold:i})=>{const o=(0,n.useRef)(null);return n.createElement("div",{className:"flex flex-col"},n.createElement("h4",{className:w()("mb-[6px] text-sm capitalize text-black",i&&"!text-base !font-normal")},e),n.createElement("div",{className:"rounded border border-dashed border-gray-400 p-4"},n.createElement("input",{ref:o,type:"file",accept:".png ,.jpg ,.jpeg",name:"file",className:"hidden",onChange:async e=>{const t=e?.target?.files[0];if(!t)return void x("Invalid file");const n=t.size/1048576;if(n<=0)return void x("Please upload valid file");if(n>3)return void x("File size is more than 3MB,please upload file size less than 3 mb");const l=t.type,r=new FormData;r.append("file",t);try{let e;e="application/pdf"===l?`${f.endpoints.upload.document}/1`:`${f.endpoints.upload.image}/1`;const t={"Content-Type":"multipart/form-data"},{status:n,data:i}=await f.post(e,r,t);if(200===n){const{statusCode:e,data:t}=i;200===e&&a(t)}else x("Failed to upload file")}catch(e){x("An error occurred during the file upload")}}}),n.createElement("label",{onClick:()=>o?.current?.click(),className:"cursor-pointer text-blue-500 hover:underline"},"Choose file")),n.createElement("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300"},"PNG or JPG (MAX.3MB)."),c(t)&&n.createElement("a",{href:(s=t,u(s)?s:`${y}/${s}`),className:"h-[25px] w-[75px] cursor-pointer content-center rounded-lg bg-green-700 text-center text-xs font-medium text-white",target:"_blank",rel:"noreferrer"},"View File"),r&&l&&String(l)?.length>0&&n.createElement("span",{className:"text-xs text-red-600"},String(l)));var s},M=({initialImages:e=[],onChange:t})=>{const[a,l]=(0,n.useState)([]),r=e=>{const a=e.map((e=>e.file));t(a)};return(0,n.useEffect)((()=>{if(!p(a)&&p(e)){const t=e.map(((e,t)=>({id:Date.now()+t,file:e})));l(t)}}),[e]),n.createElement("div",{className:"flex flex-wrap gap-10",style:{gap:"20px"}},a.map(((e,t)=>n.createElement("div",{key:e.id,className:"relative",style:{position:"relative"}},n.createElement(I,{label:`Upload ${t+1}`,value:e.file,setValue:t=>((e,t)=>{const n=a.map((a=>a.id===e?{...a,file:t}:a));l(n),r(n)})(e.id,t)}),n.createElement(k.a96,{style:{position:"absolute",right:"-8px",top:"-15px"},className:"absolute -top-2 -right-2 mt-2 mr-2 cursor-pointer text-red-500",size:24,onClick:()=>(e=>{const t=a.filter((t=>t.id!==e));l(t),r(t)})(e.id)})))),n.createElement("button",{className:"mt-4 h-fit rounded bg-blue-500 p-2 text-white",onClick:()=>{l([...a,{id:Date.now(),file:""}])},style:{backgroundColor:"#0ea5e9",height:"fit-content"}},"Upload"))};var S=a(44394);const j=({label:e,value:t,setValue:a,options:l})=>{const[r,i]=(0,n.useState)({value:"",label:e,color:"black"});return(0,n.useEffect)((()=>{const a=l.find((e=>e.value===t));i(null!=a?a:{color:"",label:e,value:""})}),[l,t]),n.createElement(S.Ay,{value:r,styles:{option:e=>({...e,color:"black"}),container:e=>({...e,width:"100%",backgroundColor:"white"}),singleValue:e=>({...e,paddingLeft:"10px",paddingRight:"10px"})},onChange:e=>a(e),options:l,className:"bg-white text-base font-normal text-black",placeholder:e})};var R=a(41179),F=a(64967),D=a(62077),T=a.n(D);a(53741);const P={height:"200px",buttonList:[["undo","redo"],["removeFormat"],["bold","underline","italic"],["font","fontSize","formatBlock"],["fontColor","hiliteColor"],["align","horizontalRule","list"],["table","link"],["image"],["lineHeight"],["fullScreen"]],katex:a(45094).A,font:["Arial","Comic Sans MS","Courier New","Impact","Georgia","Tahoma","Trebuchet MS","Verdana"],fontSize:[8,9,10,11,12,14,16,18,20,24,30],lineHeights:[{text:"1",value:1},{text:"1.15",value:1.15},{text:"1.5",value:1.5},{text:"2",value:2},{text:"2.5",value:2.5},{text:"3",value:3}],colorList:["#828282","#FF5400","#676464","#F1F2F4","#FF9B00","#F00","#fa6e30","#000","rgba(255, 153, 0, 0.1)","#FF6600","#0099FF","#74CC6D","#FF9900","#CCCCCC"]},z=({onChange:e,value:t,placeholder:a,width:l="100%",height:r="500px"})=>{const i=(0,n.useRef)();return n.createElement("div",{className:"w-full"},n.createElement(T(),{onImageUploadBefore:(e,t,a)=>{const n=e[0];(async(e,t)=>{try{const a=new FormData;a.append("file",e);const n=`${f.endpoints.upload.image}/${t}`,l={"Content-Type":"multipart/form-data"},{status:r,data:i}=await f.post(n,a,l);if(200===r){const{statusCode:e,data:t}=i;return 200===e?(v("Image uploaded successfully."),y+"/"+t):(x("Image upload failed. Please try again."),null)}return x("Error uploading the image. Server returned a non-200 status."),null}catch(e){return x("Network error occurred during image upload."),console.error("Upload error:",e),null}})(n,"ohif-viewer-uploads").then((e=>{if(e){const t={result:[{url:e,name:n.name,size:n.size}]};a(t)}else x("Image upload failed. Please try again.")}))},width:l,height:r,setContents:g(t),defaultValue:g(t),placeholder:a,setOptions:P,onChange:t=>{t=g(t),e(encodeURIComponent(t))},getSunEditorInstance:e=>{i.current=e}}))},U=({...e})=>{const[t,a]=(0,n.useState)(!0);return n.createElement("div",null,n.createElement("div",{className:"flex items-center justify-between text-black"},n.createElement("strong",null,e.sectionName),n.createElement("div",null,e.isEditEnabled&&!t&&n.createElement(R.Yvo,{className:"fill-green-600",size:20,onClick:()=>a(!0)}),e.isEditEnabled&&t&&n.createElement(F.Ny1,{className:"fill-blue-600",size:20,onClick:()=>a(!1)}))),t&&e.isEditEnabled?n.createElement("div",null,n.createElement("br",null),n.createElement(z,{value:e.value,onChange:t=>{e.onChangeValue(e.dataName,t)}})):n.createElement("div",{className:"text-black",dangerouslySetInnerHTML:{__html:g(e.value)}}),n.createElement("br",null))};var $=a(49348);function A(){const e=(0,$.zy)(),[t,a]=(0,n.useState)(null),[l,r]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const t=new URLSearchParams(e.search),n=t.get("bearer");if(c(n)){const e=decodeURIComponent(n);(e=>{o.A.setItem("token",e)})(e),a(e)}const l=t.get("reportId");c(l)&&r(Number(l))}),[e.search]),{token:t,reportId:l}}const V=({label:e,value:t})=>n.createElement("div",{className:"w-full min-w-max"},n.createElement(N,{label:e},n.createElement("p",{className:"min-w-max font-bold text-black"},t))),L=[{label:"Select Result Status",value:"",color:"black"},{label:"Normal",value:"Normal",color:"black"},{label:"Abnormal",value:"Abnormal",color:"black"}],O=[{sectionName:"Clinical Information",dataName:"clinical_history",isEditable:!1},{sectionName:"Technique",dataName:"techniques",isEditable:!1},{sectionName:"Report",dataName:"report_template",isEditable:!0}],B=()=>{const{token:e,reportId:t}=A(),{values:a,setFieldValue:r,handleSubmit:i}=(0,l.Wx)({initialValues:h,onSubmit:async e=>{await d(e)}}),[o,s]=(0,n.useState)([]),d=async e=>{try{if(!e.id)return void x("Invalid Report Id");if(!e.report_analysis_id)return void x("Invalid Report Analysis ID");if(!c(e?.patient_study_id))return void x("Invalid Study Id");if(!c(e?.patient_study_instance_id))return void x("Invalid Study Instance Id");const t={"Content-Type":"application/json"},{status:n,data:l}=await f.post(f.endpoints.report_analysis.update,JSON.stringify(e),t);if(200===n){const{statusCode:e}=l;200===e&&(p(a.images)&&(await w(),await g(a.id)),v("Success! Patient Report Saved"))}else x("Failure! Patient Report Not Saved")}catch(e){x("Something went wrong,please try again")}},g=async e=>{if(m(e))try{const t=f.endpoints.report.get+"/"+e,{status:a,data:n}=await f.get(t,{});if(200===a){const{statusCode:e,data:t}=n;if(200===e)if(p(t)){const e=t[0],a=c(e?.PatientID)?e?.PatientID:e?.patient_id??"",n=c(e?.referral_doctor)?e?.referral_doctor:e?.doctor_name??"";r("id",e?.id),r("radiologist_id",e?.radiologist_id),r("branch_name",e?.branch_name),r("radiologist_name",e?.radiologist_name),r("report_analysis_id",e?.report_analysis_id),r("PatientID",a),r("patient_id",e?.patient_id),r("patient_name",e?.patient_name),r("age",e?.age),r("gender",e?.gender),r("referral_doctor",n),r("priority_type",e?.priority_type);const l=c(e?.results_type)?e?.results_type:"Normal";r("results_type",l),r("report_status",e?.report_status),r("modality_id",e?.modality_id),r("test_type_id",e?.test_type_id),r("clinical_history",e?.clinical_history),r("clinical_history_file",e?.clinical_history_file),r("techniques",e?.techniques),r("report_template",e?.report_template),r("report_title",e?.report_title),r("patient_study_id",e?.patient_study_id),r("client_id",e?.client_id),r("branch_id",e?.branch_id),r("patient_study_id",e?.patient_study_id),r("patient_study_instance_id",e?.patient_study_instance_id),await(async e=>{try{if(!m(e))return void x("Invalid User Id");const t={"Content-Type":"application/json"},a=JSON.stringify({radiologist_id:e}),{status:n,data:l}=await f.post(f.endpoints.template.get_radiologist_templates,a,t);if(200===n){const{statusCode:e,data:t}=l;if(200===e){const e=t.map((e=>({id:e.id,value:e.id,label:e.report_template_name,modality_id:e.modality_id,test_type_id:e.test_type_id,template:e.template})));s(e)}else x("Report templates not found,please add some templates")}}catch(e){x("Report templates not found,please add some templates")}})(e?.radiologist_id),await(async e=>{if(m(e))try{const{data:t}=await f.get(`${f.endpoints.report_images.get}/${e}`),{data:a,statusCode:n}=t;if(200===n){const e=a.map((e=>`${y}/${e.image}`));r("images",e)}}catch(e){x("Something went wrong")}})(e?.report_analysis_id)}else x("Unable to fetch patient report");else x("Unable to fetch patient report")}}catch(e){x("Unable to fetch patient report")}else x("Invalid Report Id")},E=async e=>{const t=e.map((e=>({report_analysis_id:a.report_analysis_id,image:e}))),n={report_analysis_id:a.report_analysis_id,reportImages:t},l={"Content-Type":"application/json"};try{const{data:e}=await f.put(f.endpoints.report_images.update,n,l),{statusCode:t}=e;200===t?v("Image updated successfully"):x("Image update failed")}catch(e){x("Upload failed please try again")}},w=async()=>{if(!a.images.length)return void await E([]);if(a.images.find((e=>e.includes(y)))){const e=a.images.map((e=>e.replace(`${y}/`,"")));await E(e)}else await(async()=>{const e={reportImages:a.images.map((e=>({report_analysis_id:a.report_analysis_id,image:e})))};try{const{data:t}=await f.post(f.endpoints.report_images.create,e),{statusCode:a,data:n}=t;200===a?(v("Image uploaded successfully"),r("images",n)):x("Something went wrong")}catch(e){x("Something went wrong,please try again")}})()},k=c(a?.referral_doctor)?a?.referral_doctor:a?.doctor_name??"";return(0,n.useEffect)((()=>{c(e)&&m(t)&&(async()=>{await g(t)})()}),[e,t]),m(a?.id)?n.createElement("div",{style:{position:"relative"},className:"min-h-[calc(100vh-100px)] w-full overflow-y-auto rounded border border-gray-400 bg-white p-1"},n.createElement(b.l$,null),n.createElement("div",{className:"w-full border-gray-400 bg-purple-200 p-1"},n.createElement("div",{className:"mb-4 grid w-full grid-cols-2 gap-y-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2"},n.createElement(V,{label:"Patient Id",value:a?.patient_id}),n.createElement(V,{label:"Name",value:a?.patient_name}),n.createElement(V,{label:"Gender",value:a?.gender}),n.createElement(V,{label:"Age",value:a?.age}),n.createElement(V,{label:"Diagnostics",value:a?.branch_name}),n.createElement(V,{label:"Doctor",value:k}),n.createElement(V,{label:"Radiologist",value:a?.radiologist_name}),n.createElement(V,{label:"Priority",value:a?.priority_type}),n.createElement(V,{label:"Report Status",value:(S=a?.report_status,"Inprocess"===S?"In Progress":S)})),n.createElement("div",{className:"grid w-full gap-y-3"},n.createElement(N,{label:"Report Title"},n.createElement(C,{value:a.report_title,onChange:e=>r("report_title",e.target.value),placeholder:"Enter Report Title"})),n.createElement(N,{label:"Result"},n.createElement(j,{label:"Select Result",options:L,setValue:e=>r("results_type",e.value),value:a.results_type})),n.createElement(N,{label:"Template"},n.createElement(j,{label:"Select Template",options:o,setValue:e=>(e=>{r("modality_id",e.modality_id),r("test_type_id",e.test_type_id),r("template_id",e.id),r("report_template",e.template),r("report_title",e.label),r("template",e)})(e),value:a.template.value})))),n.createElement("div",null,c(a?.clinical_history_file)&&n.createElement("div",{className:"my-1"},n.createElement("h4",{className:"mb-2 text-sm font-bold text-black"},"Prescription"),n.createElement("a",{href:(I=String(a.clinical_history_file),u(I)?I:`${y}/${I}`),target:"_blank",className:"h-[35px] w-[150px] content-center items-center rounded bg-blue-700 p-1 text-center text-sm text-white dark:text-white",rel:"noreferrer"},"View File"))),n.createElement("div",{className:"my-3 w-full"},a&&O.map((e=>n.createElement(U,{key:e.dataName,isEditEnabled:e.isEditable,sectionName:e.sectionName,dataName:e.dataName,onChangeValue:r,value:a[e.dataName]})))),n.createElement("div",{className:"my-3 w-full pt-5"},n.createElement("h1",{className:"mb-5 font-bold text-black"},"Upload Images"),n.createElement(M,{initialImages:a.images,onChange:e=>r("images",e)})),n.createElement("div",{style:{position:"fixed",bottom:"10px",right:"10px"},className:"absolute z-20 flex items-center justify-end gap-x-2 border-[#CED4DA] px-4"},n.createElement("button",{className:"rounded-[4px] bg-[#6C757D] p-2 text-base font-semibold text-white"},"Cancel"),n.createElement("a",{href:`${_}/orthanc/study/files/${a.patient_study_id}`,className:"rounded-[4px] bg-blue-700 p-2 text-base font-semibold text-white",rel:"noreferrer"},"Download Files"),n.createElement("button",{className:"rounded-[4px] bg-green-700 p-2 text-base font-semibold text-white",onClick:()=>i()},"Send Report Back"))):n.createElement("div",{className:"flex h-full w-full content-center items-center justify-center rounded border border-gray-400 bg-white p-1 text-center"},c(e)?n.createElement("span",{className:"text-bold animate-pulse text-xl text-red-700"},"Loading, please wait..."):n.createElement("span",{className:"text-bold text-xl text-red-700"},"You are not authorised to view this panel, Please exit."));var I,S},q={id:"Report",preRegistration:({servicesManager:e,commandsManager:t,configuration:a={}})=>{},getPanelModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>[{name:"Report",iconName:"logo-ohif-small",iconLabel:"Report",label:"Report",component:B}],getViewportModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getToolbarModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getLayoutTemplateModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getSopClassHandlerModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getHangingProtocolModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getContextModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{},getDataSourcesModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>{}}},15069:(e,t,a)=>{var n={"./ckb.js":53648,"./cs.js":50672,"./da.js":59681,"./de.js":86461,"./en.js":15333,"./es.js":98802,"./fa.js":8727,"./fr.js":94106,"./he.js":43617,"./index.js":50072,"./it.js":77759,"./ja.js":75507,"./ko.js":52540,"./lv.js":63740,"./nl.js":58652,"./pl.js":83794,"./pt_br.js":73017,"./ro.js":56361,"./ru.js":90879,"./se.js":65382,"./tr.js":36776,"./ua.js":67176,"./ur.js":16401,"./zh_cn.js":33030};function l(e){var t=r(e);return a(t)}function r(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}l.keys=function(){return Object.keys(n)},l.resolve=r,e.exports=l,l.id=15069},75443:()=>{}}]);
//# sourceMappingURL=831.bundle.e89c39a741b4a4c68da8.js.map